<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AlphaFoxXP</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="cssescola.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
</head>

<body>
    <!-- Particles Background -->
    <div id="particles-js"></div>
    
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">
                <img src="https://i.postimg.cc/brfXwKJR/DALL-E-2024-11-16-14-19-55-A-modern-and-stylish-3-D-logo-with-the-name-Alpha-Fox-XP-in-bold-sleek.webp" alt="Logo" />
            </div>
            <div class="loading-spinner"></div>
            <div class="loading-text">AlphaFoxXP</div>
        </div>
    </div>

    <!-- Carrinho Avan√ßado -->
    <div id="carrinho-panel" class="carrinho-panel">
        <div class="carrinho-header">
            <h2><i class="ri-shopping-cart-line"></i> Seu Carrinho</h2>
            <button onclick="fecharCarrinho()" class="close-btn">
                <i class="ri-close-line"></i>
            </button>
        </div>
        <div class="carrinho-content">
            <ul id="lista-carrinho" class="lista-carrinho"></ul>
            <div class="carrinho-footer">
                <div class="total-section">
                    <p id="total-carrinho" class="total-carrinho">Total: R$ 0,00</p>
                </div>
                <button onclick="window.location.href='https://codepen.io/Escola-Garden/full/NPqBMgM'" class="btn-pagar">
                    <i class="ri-secure-payment-line"></i> Finalizar Compra
                </button>
                <button onclick="limparCarrinho()" class="btn-limpar">
                    <i class="ri-delete-bin-line"></i> Limpar Carrinho
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-container">
                    <img src="https://i.postimg.cc/brfXwKJR/DALL-E-2024-11-16-14-19-55-A-modern-and-stylish-3-D-logo-with-the-name-Alpha-Fox-XP-in-bold-sleek.webp" alt="Logo" />
                </div>
                <span class="title">AlphaFoxXP</span>
            </div>
            
            <div class="actions">
                <button class="action-btn" id="search-icon" title="Buscar">
                    <i class="ri-search-line"></i>
                </button>
                <button class="action-btn" onclick="window.location.href='teladelogin.html'" title="Login">
                    <i class="ri-user-line"></i>
                </button>
                <button class="action-btn" id="admin-access" title="Acesso Admin">
                    <i class="ri-admin-line"></i>
                </button>
                <button class="action-btn cart-btn" title="Carrinho" onclick="abrirCarrinho()">
                    <i class="ri-shopping-cart-line"></i>
                    <span id="cart-count" class="cart-count">0</span>
                </button>
                <button class="action-btn menu-btn" id="menu-toggle" title="Menu">
                    <i class="ri-menu-3-line"></i>
                </button>
            </div>
        </div>

        <nav id="menu-items" class="nav-menu">
            <button onclick="window.location.href='index.html'">
                <i class="ri-home-line"></i> In√≠cio
            </button>
            <button onclick="window.location.href='edicao.html'">
                <i class="ri-settings-line"></i> Configura√ß√£o
            </button>
            <button onclick="window.location.href='planos.html'">
                <i class="ri-vip-crown-line"></i> Planos
            </button>
            <button onclick="window.location.href='quemsomos.html'">
                <i class="ri-information-line"></i> Sobre
            </button>
            <button onclick="window.location.href='suporte.html'">
                <i class="ri-customer-service-line"></i> Suporte
            </button>
        </nav>

        <div id="search-box" class="search-box">
            <div class="search-container">
                <i class="ri-search-line"></i>
                <input type="text" id="search-input" placeholder="Buscar produtos...">
            </div>
        </div>
    </header>

    <div class="dividerPremium">
        <div class="title-container">
            <div class="title">Comprar Contas</div>
            <div class="subtitle">Produtos premium com qualidade garantida</div>
        </div>
    </div>

    <section class="categorias">
        <div class="categorias-container">
            <span class="categoria-btn active" data-cat="todos">
                <i class="ri-apps-line"></i> Todos
            </span>
            <span class="categoria-btn" data-cat="Games">
                <i class="ri-gamepad-line"></i> Games
            </span>
            <span class="categoria-btn" data-cat="Gift Cards">
                <i class="ri-gift-line"></i> Gift Cards
            </span>
            <span class="categoria-btn" data-cat="Contas">
                <i class="ri-user-settings-line"></i> Contas
            </span>
            <span class="categoria-btn" data-cat="Ofertas">
                <i class="ri-fire-line"></i> Ofertas
            </span>
            <span class="categoria-btn" data-cat="Novidades">
                <i class="ri-star-line"></i> Novidades
            </span>
        </div>
    </section>

    <main class="main-content">
        <div class="vitrine-grid" id="product-list"></div>
    </main>

    <!-- Painel Admin Modal -->
    <div id="admin-panel-bg" class="admin-modal-bg" role="dialog" aria-modal="true" aria-labelledby="admin-panel-title">
        <div id="admin-panel" class="admin-panel">
            <header class="admin-header">
                <h2 id="admin-panel-title">
                    <i class="ri-admin-line"></i> Painel Admin
                </h2>
                <button id="admin-close-btn" class="close-btn" aria-label="Fechar painel admin">
                    <i class="ri-close-line"></i>
                </button>
            </header>
            
            <nav class="admin-nav">
                <button id="btn-controle-estoque" class="admin-nav-btn">
                    <i class="ri-box-3-line"></i> Controle de Estoque
                </button>
                <button id="btn-controle-usuarios" class="admin-nav-btn">
                    <i class="ri-user-settings-line"></i> Controle de Usu√°rios
                </button>
                <button onclick="baixarDados()" class="admin-nav-btn">
                    <i class="ri-download-line"></i> Salvar Dados em JSON
                </button>
            </nav>

            <!-- Controle de Estoque -->
            <section id="controle-estoque" class="admin-section">
                <form id="novo-produto-form" class="produto-form" aria-label="Adicionar novo produto">
                    <div class="form-group">
                        <label for="input-nome">T√≠tulo do Produto</label>
                        <input type="text" id="input-nome" placeholder="Digite o t√≠tulo do an√∫ncio" required autocomplete="off" />
                    </div>
                    <div class="form-group">
                        <label for="input-descricao">Descri√ß√£o</label>
                        <textarea id="input-descricao" placeholder="Descri√ß√£o detalhada do produto" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="input-preco">Pre√ßo (R$)</label>
                        <input type="number" id="input-preco" placeholder="0.00" required step="0.01" min="0" />
                    </div>
                    <div class="form-group">
                        <label for="input-imagem">URL da Imagem</label>
                        <input type="url" id="input-imagem" placeholder="https://exemplo.com/imagem.jpg" required autocomplete="off" />
                    </div>
                    <button type="submit" class="btn-submit">
                        <i class="ri-add-line"></i> Publicar Novo An√∫ncio
                    </button>
                </form>

                <div class="estoque-table-container">
                    <table class="estoque-table" aria-label="Lista de an√∫ncios ativos">
                        <thead>
                            <tr>
                                <th>Imagem</th>
                                <th>T√≠tulo</th>
                                <th>Descri√ß√£o</th>
                                <th>Pre√ßo</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="estoque-tbody">
                            <!-- Produtos listados aqui -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Controle de Usu√°rios -->
            <section id="controle-usuarios" class="admin-section">
                <div class="coming-soon">
                    <i class="ri-tools-line"></i>
                    <h3>Funcionalidade em Desenvolvimento</h3>
                    <p>O controle de usu√°rios estar√° dispon√≠vel em breve.</p>
                </div>
            </section>
        </div>
    </div>

    <script>
        // --- Configura√ß√£o inicial ---
        const DB_KEY = 'AlphaFoxXP_DB';
        let db = null;
        let produtos = [];
        let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
        let filtroCategoria = 'todos';

        // --- Fun√ß√µes de banco de dados ---
        function carregarDB() {
            const dbLocal = localStorage.getItem(DB_KEY);
            if (!dbLocal) {
                const inicial = { estoque: [], usuarios: [] };
                localStorage.setItem(DB_KEY, JSON.stringify(inicial));
                return inicial;
            }
            return JSON.parse(dbLocal);
        }

        function salvarDB(database) {
            localStorage.setItem(DB_KEY, JSON.stringify(database));
        }

        // --- Carregar dados externos do JSON ---
        async function carregarDadosExternos() {
            try {
                console.log('Tentando carregar dados externos...');
                const response = await fetch("./AlphaFoxXP_Dados.json");
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const dados = await response.json();
                console.log('Dados carregados do JSON:', dados);

                // Atualiza o banco local com os dados do arquivo
                if (dados.estoque && Array.isArray(dados.estoque)) {
                    db.estoque = dados.estoque;
                    produtos = db.estoque;
                    salvarDB(db);
                    console.log('Produtos atualizados:', produtos.length);
                }

                // Renderiza a vitrine com os dados carregados
                renderVitrine();
                
            } catch (err) {
                console.error("Falha ao carregar dados externos:", err);
                // Se der erro, usa os dados salvos no localStorage
                produtos = db.estoque || [];
                renderVitrine();
            }
        }

        // --- Inicializa√ß√£o ---
        async function inicializar() {
            // Carrega o banco de dados local
            db = carregarDB();
            produtos = db.estoque || [];
            
            // Tenta carregar dados externos
            await carregarDadosExternos();
            
            // Inicializa outros componentes
            atualizarContadorCarrinho();
            configurarEventListeners();
        }

        // --- Render Vitrine de produtos ---
        function renderVitrine() {
            const productList = document.getElementById('product-list');
            if (!productList) return;

            productList.innerHTML = '';
            
            const listaFiltrada = filtroCategoria === 'todos' 
                ? produtos 
                : produtos.filter(p => p.categoria === filtroCategoria);
            
            if (listaFiltrada.length === 0) {
                productList.innerHTML = `
                    <div class="empty-state">
                        <i class="ri-inbox-line"></i>
                        <h3>Nenhum produto encontrado</h3>
                        <p>Tente ajustar os filtros ou buscar por outros termos</p>
                    </div>
                `;
                return;
            }

            listaFiltrada.forEach(p => {
                const div = document.createElement('div');
                div.className = 'product-card';
                div.innerHTML = `
                    <div class="card-image">
                        <img src="${p.imagem}" alt="${p.nome}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x200?text=Imagem+Indispon√≠vel'">
                        <div class="card-overlay">
                            <button class="quick-view-btn" onclick='adicionarAoCarrinho(${JSON.stringify(p).replace(/'/g, "'")})'>
                                <i class="ri-shopping-cart-line"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">${p.nome}</h3>
                        <p class="card-description">${p.descricao ? p.descricao.substring(0, 60) + '...' : ''}</p>
                        <div class="card-footer">
                            <span class="card-price">R$ ${parseFloat(p.preco).toFixed(2)}</span>
                            <button class="add-to-cart-btn" onclick='adicionarAoCarrinho(${JSON.stringify(p).replace(/'/g, "'")})'>
                                <i class="ri-add-line"></i> Adicionar
                            </button>
                        </div>
                    </div>
                `;
                productList.appendChild(div);
            });
        }

        // --- Configurar Event Listeners ---
        function configurarEventListeners() {
            // Busca din√¢mica
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const termo = this.value.toLowerCase();
                    const listaFiltrada = produtos.filter(p => 
                        p.nome.toLowerCase().includes(termo) || 
                        (p.descricao && p.descricao.toLowerCase().includes(termo))
                    );
                    
                    const productList = document.getElementById('product-list');
                    productList.innerHTML = '';
                    
                    if (listaFiltrada.length === 0) {
                        productList.innerHTML = `
                            <div class="empty-state">
                                <i class="ri-search-line"></i>
                                <h3>Nenhum resultado encontrado</h3>
                                <p>Tente buscar por outros termos</p>
                            </div>
                        `;
                        return;
                    }

                    listaFiltrada.forEach(p => {
                        const div = document.createElement('div');
                        div.className = 'product-card';
                        div.innerHTML = `
                            <div class="card-image">
                                <img src="${p.imagem}" alt="${p.nome}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x200?text=Imagem+Indispon√≠vel'">
                                <div class="card-overlay">
                                    <button class="quick-view-btn" onclick='adicionarAoCarrinho(${JSON.stringify(p).replace(/'/g, "'")})'>
                                        <i class="ri-shopping-cart-line"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-content">
                                <h3 class="card-title">${p.nome}</h3>
                                <p class="card-description">${p.descricao ? p.descricao.substring(0, 60) + '...' : ''}</p>
                                <div class="card-footer">
                                    <span class="card-price">R$ ${parseFloat(p.preco).toFixed(2)}</span>
                                    <button class="add-to-cart-btn" onclick='adicionarAoCarrinho(${JSON.stringify(p).replace(/'/g, "'")})'>
                                        <i class="ri-add-line"></i> Adicionar
                                    </button>
                                </div>
                            </div>
                        `;
                        productList.appendChild(div);
                    });
                });
            }

            // Filtros de categoria
            const categorias = document.querySelectorAll('.categoria-btn');
            categorias.forEach(cat => {
                cat.addEventListener('click', () => {
                    categorias.forEach(c => c.classList.remove('active'));
                    cat.classList.add('active');
                    filtroCategoria = cat.dataset.cat;
                    renderVitrine();
                });
            });

            // Busca toggle
            const searchIcon = document.getElementById('search-icon');
            const searchBox = document.getElementById('search-box');
            
            if (searchIcon && searchBox) {
                searchIcon.addEventListener('click', () => {
                    if (searchBox.classList.contains('active')) {
                        searchBox.classList.remove('active');
                        if (searchInput) {
                            searchInput.value = '';
                        }
                        renderVitrine();
                    } else {
                        searchBox.classList.add('active');
                        if (searchInput) {
                            searchInput.focus();
                        }
                    }
                });
            }

            // Menu toggle
            const menuToggle = document.getElementById('menu-toggle');
            const menuItems = document.getElementById('menu-items');
            
            if (menuToggle && menuItems) {
                menuToggle.addEventListener('click', () => {
                    menuItems.classList.toggle('active');
                });
            }

            // Admin panel
            configurarPainelAdmin();
        }

        // --- Configurar Painel Admin ---
        function configurarPainelAdmin() {
            const adminPanelBg = document.getElementById('admin-panel-bg');
            const adminCloseBtn = document.getElementById('admin-close-btn');
            const adminAccess = document.getElementById('admin-access');
            const btnEstoque = document.getElementById('btn-controle-estoque');
            const btnUsuarios = document.getElementById('btn-controle-usuarios');

            if (adminAccess) {
                adminAccess.addEventListener('click', () => {
                    const senha = prompt('Acesso Restrito - Insira o c√≥digo de seguran√ßa:');
                    if (senha === '454') {
                        if (adminPanelBg) {
                            adminPanelBg.style.display = 'flex';
                            mostrarTelaAdmin('estoque');
                        }
                    } else {
                        alert('C√≥digo inv√°lido!');
                    }
                });
            }

            if (adminCloseBtn && adminPanelBg) {
                adminCloseBtn.addEventListener('click', () => {
                    adminPanelBg.style.display = 'none';
                    limparCamposProduto();
                });
            }

            if (btnEstoque) {
                btnEstoque.addEventListener('click', () => mostrarTelaAdmin('estoque'));
            }

            if (btnUsuarios) {
                btnUsuarios.addEventListener('click', () => {
                    window.location.href = 'usuariostyr.html';
                });
            }

            // Form de novo produto
            const formNovoProduto = document.getElementById('novo-produto-form');
            if (formNovoProduto) {
                formNovoProduto.addEventListener('submit', handleSubmitProduto);
            }
        }

        // --- Fun√ß√µes do Admin ---
        function mostrarTelaAdmin(tela) {
            const controleEstoque = document.getElementById('controle-estoque');
            const controleUsuarios = document.getElementById('controle-usuarios');

            if (tela === 'estoque') {
                if (controleEstoque) controleEstoque.style.display = 'block';
                if (controleUsuarios) controleUsuarios.style.display = 'none';
                carregarTabelaEstoque();
            } else if (tela === 'usuarios') {
                if (controleEstoque) controleEstoque.style.display = 'none';
                if (controleUsuarios) controleUsuarios.style.display = 'block';
            }
        }

        function carregarTabelaEstoque() {
            const estoqueTbody = document.getElementById('estoque-tbody');
            if (!estoqueTbody) return;

            estoqueTbody.innerHTML = '';
            
            if (!db.estoque || db.estoque.length === 0) {
                estoqueTbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 2rem;">
                            <i class="ri-inbox-line" style="font-size: 2rem; color: #666;"></i>
                            <p>Nenhum produto cadastrado</p>
                        </td>
                    </tr>
                `;
                return;
            }

            db.estoque.forEach((produto, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <img src="${produto.imagem}" alt="${produto.nome}" class="table-image" onerror="this.src='https://via.placeholder.com/50x50?text=N/A'">
                    </td>
                    <td class="table-title">${produto.nome}</td>
                    <td class="table-description">${produto.descricao}</td>
                    <td class="table-price">R$ ${parseFloat(produto.preco).toFixed(2)}</td>
                    <td class="table-actions">
                        <button onclick="editarProduto(${idx})" class="edit-btn" title="Editar">
                            <i class="ri-edit-line"></i>
                        </button>
                        <button onclick="removerProduto(${idx})" class="delete-btn" title="Remover">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </td>
                `;
                estoqueTbody.appendChild(tr);
            });
        }

        function handleSubmitProduto(e) {
            e.preventDefault();
            
            const inputNome = document.getElementById('input-nome');
            const inputDescricao = document.getElementById('input-descricao');
            const inputPreco = document.getElementById('input-preco');
            const inputImagem = document.getElementById('input-imagem');

            if (!inputNome || !inputDescricao || !inputPreco || !inputImagem) {
                alert('Erro: Campos do formul√°rio n√£o encontrados.');
                return;
            }

            const nome = inputNome.value.trim();
            const descricao = inputDescricao.value.trim();
            const preco = parseFloat(inputPreco.value);
            const imagem = inputImagem.value.trim();

            if (!nome || !descricao || isNaN(preco) || preco < 0 || !imagem) {
                alert('Preencha todos os campos corretamente.');
                return;
            }

            const novoProduto = {
                nome,
                descricao,
                preco,
                imagem,
                categoria: detectarCategoria(nome, descricao)
            };

            const formNovoProduto = document.getElementById('novo-produto-form');
            if (formNovoProduto.dataset.editIndex !== undefined) {
                const idx = parseInt(formNovoProduto.dataset.editIndex);
                db.estoque[idx] = novoProduto;
                alert('Produto atualizado com sucesso!');
            } else {
                db.estoque.push(novoProduto);
                alert('Produto adicionado com sucesso!');
            }

            salvarDB(db);
            produtos = db.estoque;
            carregarTabelaEstoque();
            renderVitrine();
            limparCamposProduto();
        }

        function detectarCategoria(nome, descricao) {
            const texto = (nome + ' ' + descricao).toLowerCase();
            if (texto.includes('game') || texto.includes('jogo')) return 'Games';
            if (texto.includes('gift card')) return 'Gift Cards';
            if (texto.includes('conta')) return 'Contas';
            if (texto.includes('oferta')) return 'Ofertas';
            if (texto.includes('novo')) return 'Novidades';
            return 'Outros';
        }

        function limparCamposProduto() {
            const inputNome = document.getElementById('input-nome');
            const inputDescricao = document.getElementById('input-descricao');
            const inputPreco = document.getElementById('input-preco');
            const inputImagem = document.getElementById('input-imagem');
            const formNovoProduto = document.getElementById('novo-produto-form');

            if (inputNome) inputNome.value = '';
            if (inputDescricao) inputDescricao.value = '';
            if (inputPreco) inputPreco.value = '';
            if (inputImagem) inputImagem.value = '';
            if (formNovoProduto) delete formNovoProduto.dataset.editIndex;
        }

        // --- Fun√ß√µes globais para os bot√µes ---
        window.editarProduto = function(index) {
            const p = db.estoque[index];
            const inputNome = document.getElementById('input-nome');
            const inputDescricao = document.getElementById('input-descricao');
            const inputPreco = document.getElementById('input-preco');
            const inputImagem = document.getElementById('input-imagem');
            const formNovoProduto = document.getElementById('novo-produto-form');

            if (inputNome) inputNome.value = p.nome;
            if (inputDescricao) inputDescricao.value = p.descricao;
            if (inputPreco) inputPreco.value = p.preco;
            if (inputImagem) inputImagem.value = p.imagem;
            if (formNovoProduto) formNovoProduto.dataset.editIndex = index;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.removerProduto = function(index) {
            if (confirm('Deseja realmente remover este produto?')) {
                db.estoque.splice(index, 1);
                salvarDB(db);
                produtos = db.estoque;
                carregarTabelaEstoque();
                renderVitrine();
            }
        };

        // --- Fun√ß√µes do Carrinho ---
        function salvarCarrinho() {
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            atualizarContadorCarrinho();
        }

        function atualizarContadorCarrinho() {
            const contador = document.getElementById('cart-count');
            if (contador) {
                const total = carrinho.reduce((sum, item) => sum + item.quantidade, 0);
                contador.textContent = total;
                contador.style.display = total > 0 ? 'flex' : 'none';
            }
        }

        function mostrarToast(mensagem, tipo = 'success', tempo = 3000) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `toast toast-${tipo}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-message">${mensagem}</span>
                    <button class="toast-close" onclick="this.parentElement.parentElement.remove()">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
            `;
            container.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, tempo);
        }

        function adicionarAoCarrinho(produto) {
            const existente = carrinho.find(p => p.nome === produto.nome);
            if (existente) {
                existente.quantidade += 1;
            } else {
                carrinho.push({ ...produto, quantidade: 1 });
            }
            salvarCarrinho();
            renderCarrinho();
            mostrarToast(`‚úÖ <strong>${produto.nome}</strong> adicionado ao carrinho.`);
        }

        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            salvarCarrinho();
            renderCarrinho();
        }

        function alterarQuantidade(index, delta) {
            carrinho[index].quantidade += delta;
            if (carrinho[index].quantidade <= 0) {
                removerDoCarrinho(index);
            } else {
                salvarCarrinho();
                renderCarrinho();
            }
        }

        function limparCarrinho() {
            if (confirm('Tem certeza que deseja limpar o carrinho?')) {
                carrinho = [];
                salvarCarrinho();
                renderCarrinho();
                mostrarToast('üßπ Carrinho limpo com sucesso.');
            }
        }

        function calcularTotal() {
            return carrinho.reduce((soma, item) => soma + item.preco * item.quantidade, 0);
        }

               function renderCarrinho() {
            const lista = document.getElementById('lista-carrinho');
            const totalEl = document.getElementById('total-carrinho');
            
            if (!lista || !totalEl) return;
            
            lista.innerHTML = '';
            
            if (carrinho.length === 0) {
                lista.innerHTML = `
                    <li class="carrinho-empty">
                        <i class="ri-shopping-cart-line"></i>
                        <p>Seu carrinho est√° vazio</p>
                    </li>
                `;
                totalEl.textContent = 'Total: R$ 0,00';
                return;
            }

            carrinho.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'carrinho-item';
                li.innerHTML = `
                    <div class="item-image">
                        <img src="${item.imagem}" alt="${item.nome}" onerror="this.src='https://via.placeholder.com/50x50?text=N/A'">
                    </div>
                    <div class="item-details">
                        <h4>${item.nome}</h4>
                        <p class="item-price">R$ ${parseFloat(item.preco).toFixed(2)}</p>
                    </div>
                    <div class="item-controls">
                        <div class="quantity-controls">
                            <button onclick="alterarQuantidade(${index}, -1)" class="qty-btn">
                                <i class="ri-subtract-line"></i>
                            </button>
                            <span class="quantity">${item.quantidade}</span>
                            <button onclick="alterarQuantidade(${index}, 1)" class="qty-btn">
                                <i class="ri-add-line"></i>
                            </button>
                        </div>
                        <button onclick="removerDoCarrinho(${index})" class="remove-btn" title="Remover item">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                `;
                lista.appendChild(li);
            });

            totalEl.textContent = 'Total: R$ ' + calcularTotal().toFixed(2);
        }

        function abrirCarrinho() {
            renderCarrinho();
            const carrinhoPanel = document.getElementById('carrinho-panel');
            if (carrinhoPanel) {
                carrinhoPanel.classList.add('active');
            }
        }

        function fecharCarrinho() {
            const carrinhoPanel = document.getElementById('carrinho-panel');
            if (carrinhoPanel) {
                carrinhoPanel.classList.remove('active');
            }
        }

        function baixarDados() {
            const dados = {
                banco: carregarDB(),
                carrinho: carrinho
            };
            const conteudo = JSON.stringify(dados, null, 2);
            const blob = new Blob([conteudo], { type: "application/json" });
            const url = URL.createObjectURL(blob);
           
            const a = document.createElement("a");
            a.href = url;
            a.download = "AlphaFoxXP_Dados.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        // --- Fun√ß√µes globais para os bot√µes do carrinho ---
        window.adicionarAoCarrinho = adicionarAoCarrinho;
        window.removerDoCarrinho = removerDoCarrinho;
        window.alterarQuantidade = alterarQuantidade;
        window.limparCarrinho = limparCarrinho;
        window.abrirCarrinho = abrirCarrinho;
        window.fecharCarrinho = fecharCarrinho;
        window.baixarDados = baixarDados;

        // --- Particles.js Configuration ---
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: "#ff5722" },
                shape: {
                    type: "circle",
                    stroke: { width: 0, color: "#000000" },
                    polygon: { nb_sides: 5 }
                },
                opacity: {
                    value: 0.5,
                    random: false,
                    anim: { enable: false, speed: 1, opacity_min: 0.1, sync: false }
                },
                size: {
                    value: 3,
                    random: true,
                    anim: { enable: false, speed: 40, size_min: 0.1, sync: false }
                },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#ff5722",
                    opacity: 0.4,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 6,
                    direction: "none",
                    random: false,
                    straight: false,
                    out_mode: "out",
                    bounce: false,
                    attract: { enable: false, rotateX: 600, rotateY: 1200 }
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "repulse" },
                    onclick: { enable: true, mode: "push" },
                    resize: true
                },
                modes: {
                    grab: { distance: 400, line_linked: { opacity: 1 } },
                    bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 },
                    repulse: { distance: 200, duration: 0.4 },
                    push: { particles_nb: 4 },
                    remove: { particles_nb: 2 }
                }
            },
            retina_detect: true
        });

        // --- Loading Screen ---
        window.addEventListener('load', function() {
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }
            }, 2000);
        });

        // --- Inicializa√ß√£o quando o DOM estiver carregado ---
        document.addEventListener('DOMContentLoaded', function() {
            inicializar();
        });

        // --- Fallback para garantir que a inicializa√ß√£o aconte√ßa ---
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', inicializar);
        } else {
            inicializar();
        }
    </script>
</body>
</html>
